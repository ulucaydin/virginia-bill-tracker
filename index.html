<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virginia Bill Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-primary: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --success: #10b981;
            --success-bg: #ecfdf5;
            --warning: #f59e0b;
            --warning-bg: #fffbeb;
            --error: #ef4444;
            --error-bg: #fef2f2;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius: 8px;
            --radius-lg: 12px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 24px;
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: var(--bg-card);
            padding: 24px 28px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .header h1 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .sync-info {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .sync-time {
            color: var(--accent);
            font-weight: 600;
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.15s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
            border-color: var(--text-muted);
            color: var(--text-primary);
        }

        .changes-banner {
            background: var(--warning-bg);
            border: 1px solid #fcd34d;
            padding: 14px 18px;
            margin-bottom: 20px;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            color: #92400e;
        }

        .changes-banner.no-changes {
            background: var(--success-bg);
            border-color: #6ee7b7;
            color: #065f46;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.15s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-card);
            padding: 28px;
            border-radius: var(--radius-lg);
            max-width: 560px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.2s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.125rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-muted);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            transition: all 0.15s ease;
        }

        .close-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.15s ease;
            background: var(--bg-card);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-help {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 6px;
            line-height: 1.5;
        }

        .form-help a {
            color: var(--accent);
            text-decoration: none;
        }

        .form-help a:hover {
            text-decoration: underline;
        }

        .bills-list {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 12px;
            max-height: 180px;
            overflow-y: auto;
            background: var(--bg-primary);
        }

        .bill-tag {
            display: inline-flex;
            align-items: center;
            background: var(--accent);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            margin: 3px;
            font-size: 12px;
            font-weight: 500;
        }

        .bill-tag button {
            background: none;
            border: none;
            color: rgba(255,255,255,0.8);
            margin-left: 6px;
            cursor: pointer;
            font-size: 14px;
            line-height: 1;
            padding: 0;
            transition: color 0.15s ease;
        }

        .bill-tag button:hover {
            color: white;
        }

        .add-bill-form {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .add-bill-form input {
            flex: 1;
        }

        .alert {
            padding: 12px 16px;
            border-radius: var(--radius);
            margin-bottom: 16px;
            font-size: 14px;
            font-weight: 500;
        }

        .alert-info {
            background: #eff6ff;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .alert-success {
            background: var(--success-bg);
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .alert-error {
            background: var(--error-bg);
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .bills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .bill-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .bill-card:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .bill-card.has-changes {
            border-color: var(--warning);
            background: var(--warning-bg);
        }

        .bill-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .bill-number {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .bill-status {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            white-space: nowrap;
        }

        .status-left-in-committee {
            background: var(--warning-bg);
            color: #b45309;
        }

        .status-in-committee,
        .status-pending {
            background: #eff6ff;
            color: #1d4ed8;
        }

        .status-passed,
        .status-passed-senate,
        .status-passed-house,
        .status-passed-both-chambers {
            background: var(--success-bg);
            color: #047857;
        }

        .status-signed-into-law {
            background: #f0fdf4;
            color: #15803d;
        }

        .status-failed,
        .status-vetoed {
            background: var(--error-bg);
            color: #b91c1c;
        }

        .status-continued {
            background: #faf5ff;
            color: #7c3aed;
        }

        .status-not-found {
            background: var(--bg-primary);
            color: var(--text-muted);
        }

        .bill-summary {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.65;
            margin-bottom: 16px;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex-grow: 1;
        }

        .bill-card:hover .bill-summary {
            color: var(--text-primary);
        }

        .bill-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }

        .expand-hint {
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 500;
            transition: color 0.15s ease;
        }

        .bill-card:hover .expand-hint {
            color: var(--accent);
        }

        .bill-link {
            color: var(--accent);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.15s ease;
        }

        .bill-link:hover {
            color: var(--accent-hover);
        }

        .change-badge {
            background: #fef3c7;
            color: #b45309;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-left: 8px;
        }

        .changes-section {
            background: var(--bg-card);
            padding: 24px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
        }

        .changes-section h2 {
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .change-item {
            padding: 12px 14px;
            background: var(--bg-primary);
            border-radius: var(--radius);
            margin-bottom: 8px;
            border-left: 3px solid var(--accent);
        }

        .change-item:last-child {
            margin-bottom: 0;
        }

        .change-timestamp {
            color: var(--text-muted);
            font-size: 12px;
            margin-top: 4px;
        }

        .no-bills {
            background: var(--bg-card);
            padding: 48px;
            border-radius: var(--radius-lg);
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .no-bills h2 {
            color: var(--text-primary);
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .no-bills p {
            color: var(--text-muted);
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 24px;
            color: var(--text-muted);
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è Virginia Bill Tracker</h1>
            <div class="header-actions">
                <div class="sync-info">
                    Last synced: <span class="sync-time">January 13, 2026 at 10:08 PM ET</span>
                </div>
                <button class="btn" onclick="openConfigModal()">‚öôÔ∏è Configure Bills</button>
            </div>
        </div>
        

        <div class="changes-banner no-changes">
            <strong>‚úÖ No changes detected</strong>
        </div>
        <div class="bills-grid">

            <div class="bill-card " onclick="openBillDetail('HB9')">
                <div class="bill-header">
                    <div class="bill-number">
                        HB9
                        
                    </div>
                    <div class="bill-status status-left-in-committee">
                        Left in Committee
                    </div>
                </div>
                <div class="bill-summary">
                    Animal control officers; additional training. Increases the number of hours of required additional training in animal control and protection from 15 to 24 every three years for all animal control officers and deputy animal control officers employed by a locality.
                </div>
                <div class="bill-footer">
                    <span class="expand-hint">Click to view details</span>
                    <a href="https://lis.virginia.gov/bill-details/20251/HB9" target="_blank" class="bill-link" onclick="event.stopPropagation()">
                        View on LIS ‚Üí
                    </a>
                </div>
            </div>

            <div class="bill-card " onclick="openBillDetail('SB10')">
                <div class="bill-header">
                    <div class="bill-number">
                        SB10
                        
                    </div>
                    <div class="bill-status status-left-in-committee">
                        Left in Committee
                    </div>
                </div>
                <div class="bill-summary">
                    Income tax subtraction; military  retirement
benefits; uniformed services. Expands the definition of 'military
benefits' to  include an income tax subtraction of retirement income
received for  service in the uniformed services of the United  States,
which includes the United States Armed  Forces, the commissioned corps
of the National  Oceanic and Atmospheric Administration, and the 
commissioned corps of the United States  Public Health Service. Under
current law, the subtraction is only allowed for  military retirement
income received for service in the  United States Armed Forces.
                </div>
                <div class="bill-footer">
                    <span class="expand-hint">Click to view details</span>
                    <a href="https://lis.virginia.gov/bill-details/20251/SB10" target="_blank" class="bill-link" onclick="event.stopPropagation()">
                        View on LIS ‚Üí
                    </a>
                </div>
            </div>

            <div class="bill-card " onclick="openBillDetail('SB33')">
                <div class="bill-header">
                    <div class="bill-number">
                        SB33
                        
                    </div>
                    <div class="bill-status status-passed-senate">
                        Passed Senate
                    </div>
                </div>
                <div class="bill-summary">
                    Supervision of certified registered nurse anesthetists;
 work group; report. Clarifies that supervision  of a certified
registered nurse anesthetist requires that a  licensed doctor of medicine,
osteopathy, podiatry,  or dentistry is present during an operation
or procedure or is immediately available to respond  and provide patient
care as needed. The bill directs the Secretary of Health  and Human
Resources, in collaboration with the Board of Medicine, Board of 
Nursing, and Department of Health Professions, to convene a work group
 of relevant stakeholders to evaluate and make recommendations to
increase the  anesthesia provider workforce in the Commonwealth. The
bill requires the work  group to report its recommendations to the
Chairmen of the Senate Committee on Education and Health and the House
Committee on Health and Human Services by November  1, 2024.
                </div>
                <div class="bill-footer">
                    <span class="expand-hint">Click to view details</span>
                    <a href="https://lis.virginia.gov/bill-details/20251/SB33" target="_blank" class="bill-link" onclick="event.stopPropagation()">
                        View on LIS ‚Üí
                    </a>
                </div>
            </div>
        </div>

        <div class="changes-section">
            <h2>Recent Changes</h2>

            <div class="change-item">
                <div>Started tracking HB9</div>
                <div class="change-timestamp">
                    January 13, 2026 at 10:08 PM
                </div>
            </div>

            <div class="change-item">
                <div>Started tracking SB10</div>
                <div class="change-timestamp">
                    January 13, 2026 at 10:08 PM
                </div>
            </div>

            <div class="change-item">
                <div>Started tracking SB33</div>
                <div class="change-timestamp">
                    January 13, 2026 at 10:08 PM
                </div>
            </div>

        </div>

    <!-- Bill Detail Modal -->
    <div id="billDetailModal" class="modal">
        <div class="modal-content detail-modal">
            <div class="modal-header">
                <h2 id="detailBillNumber">Bill Details</h2>
                <button class="close-btn" onclick="closeBillDetail()">&times;</button>
            </div>

            <div class="detail-meta">
                <span class="detail-status-pill" id="detailBillStatus"></span>
                <span class="detail-patron" id="detailPatron"></span>
            </div>

            <div class="detail-section">
                <div class="detail-label">Summary</div>
                <p id="detailSummary" class="detail-summary-full"></p>
            </div>

            <div class="detail-section" id="detailActionSection">
                <div class="detail-label">Last Action</div>
                <div class="detail-action-box">
                    <p id="detailLastAction" class="detail-action-text"></p>
                    <p class="detail-date" id="detailLastActionDate"></p>
                </div>
            </div>

            <div class="detail-footer">
                <button class="btn btn-secondary" onclick="closeBillDetail()">Close</button>
                <a id="detailLisLink" href="#" target="_blank" class="btn">View on LIS ‚Üí</a>
            </div>
        </div>
    </div>

    <style>
        .detail-modal {
            max-width: 650px;
        }
        .detail-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e5e7eb;
        }
        .detail-status-pill {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .detail-status-pill.status-left-in-committee {
            background: #fef3c7;
            color: #92400e;
        }
        .detail-status-pill.status-passed-senate,
        .detail-status-pill.status-passed-house,
        .detail-status-pill.status-passed-both-chambers {
            background: #d1fae5;
            color: #065f46;
        }
        .detail-status-pill.status-signed-into-law {
            background: #c7d2fe;
            color: #3730a3;
        }
        .detail-status-pill.status-vetoed,
        .detail-status-pill.status-failed {
            background: #fee2e2;
            color: #991b1b;
        }
        .detail-status-pill.status-in-committee,
        .detail-status-pill.status-pending {
            background: #dbeafe;
            color: #1e40af;
        }
        .detail-patron {
            color: #6b7280;
            font-size: 14px;
            font-style: italic;
        }
        .detail-section {
            margin-bottom: 24px;
        }
        .detail-label {
            color: #6b7280;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .detail-summary-full {
            color: #1f2937;
            font-size: 15px;
            line-height: 1.75;
            margin: 0;
        }
        .detail-action-box {
            background: #f9fafb;
            border-radius: 8px;
            padding: 12px 16px;
            border-left: 3px solid #667eea;
        }
        .detail-action-text {
            color: #374151;
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
        }
        .detail-date {
            color: #9ca3af;
            font-size: 12px;
            margin-top: 6px;
        }
        .detail-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }
    </style>

    <!-- Configuration Modal -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configure Tracked Bills</h2>
                <button class="close-btn" onclick="closeConfigModal()">&times;</button>
            </div>
            
            <div id="alertContainer"></div>
            
            <div class="form-group">
                <label>GitHub Personal Access Token</label>
                <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" onchange="saveTokenToStorage()">
                <div class="form-help">
                    Required to save changes. Your token is saved locally in your browser for convenience.
                    <br>Create one at:
                    <a href="https://github.com/settings/tokens/new?scopes=repo&description=Virginia%20Bill%20Tracker" target="_blank">
                        GitHub Settings ‚Üí Tokens
                    </a>
                    (select "repo" scope)
                </div>
            </div>
            
            <div class="form-group">
                <label>Tracked Bills</label>
                <div class="bills-list" id="billsList">
                    <!-- Bills will be rendered here -->
                </div>
                <div class="add-bill-form">
                    <input type="text" id="newBillInput" placeholder="Enter bill ID (e.g., HB1, SB200)" 
                           onkeypress="if(event.key==='Enter')addBill()">
                    <button class="btn" onclick="addBill()">Add Bill</button>
                </div>
                <div class="form-help">
                    Find bill IDs at: <a href="https://lis.virginia.gov/bill-search" target="_blank">Virginia LIS</a>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeConfigModal()">Cancel</button>
                <button class="btn" onclick="saveConfiguration()">üíæ Save Changes</button>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration data
        let trackedBills = ["HB9", "SB10", "SB33"];
        const REPO_NAME = 'ulucaydin/virginia-bill-tracker';
        const CONFIG_FILE_PATH = 'bills_to_track.json';

        // Bills data for detail modal
        const billsData = {"HB9": {"bill_number": "HB9", "status": "Left in Committee", "summary": "Animal control officers; additional training. Increases the number of hours of required additional training in animal control and protection from 15 to 24 every three years for all animal control officers and deputy animal control officers employed by a locality.", "last_action": "Left in Agriculture, Chesapeake and Natural Resources", "last_action_date": "11/18/2024", "patron": "Ennis", "bill_url": "https://lis.virginia.gov/bill-details/20251/HB9"}, "SB10": {"bill_number": "SB10", "status": "Left in Committee", "summary": "Income tax subtraction; military  retirement\r\nbenefits; uniformed services. Expands the definition of 'military\r\nbenefits' to  include an income tax subtraction of retirement income\r\nreceived for  service in the uniformed services of the United  States,\r\nwhich includes the United States Armed  Forces, the commissioned corps\r\nof the National  Oceanic and Atmospheric Administration, and the \r\ncommissioned corps of the United States  Public Health Service. Under\r\ncurrent law, the subtraction is only allowed for  military retirement\r\nincome received for service in the  United States Armed Forces.", "last_action": "Left in Finance and Appropriations", "last_action_date": "11/19/2024", "patron": "Reeves", "bill_url": "https://lis.virginia.gov/bill-details/20251/SB10"}, "SB33": {"bill_number": "SB33", "status": "Passed Senate", "summary": "Supervision of certified registered nurse anesthetists;\r\n work group; report. Clarifies that supervision  of a certified\r\nregistered nurse anesthetist requires that a  licensed doctor of medicine,\r\nosteopathy, podiatry,  or dentistry is present during an operation\r\nor procedure or is immediately available to respond  and provide patient\r\ncare as needed. The bill directs the Secretary of Health  and Human\r\nResources, in collaboration with the Board of Medicine, Board of \r\nNursing, and Department of Health Professions, to convene a work group\r\n of relevant stakeholders to evaluate and make recommendations to\r\nincrease the  anesthesia provider workforce in the Commonwealth. The\r\nbill requires the work  group to report its recommendations to the\r\nChairmen of the Senate Committee on Education and Health and the House\r\nCommittee on Health and Human Services by November  1, 2024.", "last_action": "Left in Health and Human Services", "last_action_date": "11/18/2024", "patron": "Locke", "bill_url": "https://lis.virginia.gov/bill-details/20251/SB33"}};

        // Bill Detail Modal functions
        function openBillDetail(billNum) {
            const bill = billsData[billNum];
            if (!bill) return;

            document.getElementById('detailBillNumber').textContent = bill.bill_number;
            const statusEl = document.getElementById('detailBillStatus');
            statusEl.textContent = bill.status;
            statusEl.className = 'detail-status-pill status-' + bill.status.toLowerCase().replace(/ /g, '-');
            document.getElementById('detailSummary').textContent = bill.summary;
            document.getElementById('detailLisLink').href = bill.bill_url;

            // Show patron if available
            const patronEl = document.getElementById('detailPatron');
            if (bill.patron) {
                patronEl.textContent = 'Patron: ' + bill.patron;
                patronEl.style.display = 'inline';
            } else {
                patronEl.style.display = 'none';
            }

            // Show last action if available
            const actionSection = document.getElementById('detailActionSection');
            if (bill.last_action && bill.last_action !== 'No action recorded') {
                document.getElementById('detailLastAction').textContent = bill.last_action;
                document.getElementById('detailLastActionDate').textContent = bill.last_action_date || '';
                actionSection.style.display = 'block';
            } else {
                actionSection.style.display = 'none';
            }

            document.getElementById('billDetailModal').classList.add('active');
        }

        function closeBillDetail() {
            document.getElementById('billDetailModal').classList.remove('active');
        }

        // Close detail modal on outside click
        document.getElementById('billDetailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBillDetail();
            }
        });

        // Render bills list
        function renderBillsList() {
            const container = document.getElementById('billsList');
            if (trackedBills.length === 0) {
                container.innerHTML = '<p style="color: #666; padding: 10px;">No bills tracked yet. Add one below.</p>';
                return;
            }
            
            container.innerHTML = trackedBills.map(bill => 
                `<span class="bill-tag">
                    ${bill}
                    <button onclick="removeBill('${bill}')">&times;</button>
                </span>`
            ).join('');
        }
        
        // Add bill
        function addBill() {
            const input = document.getElementById('newBillInput');
            let billId = input.value.trim().toUpperCase();
            
            if (!billId) return;
            
            // Validate format (HB/SB followed by number)
            if (!billId.match(/^(HB|SB|HJR|SJR|HR|SR)\d+$/i)) {
                showAlert('Please enter a valid bill ID (e.g., HB1, SB200)', 'error');
                return;
            }
            
            if (trackedBills.includes(billId)) {
                showAlert('Bill already tracked', 'error');
                return;
            }
            
            trackedBills.push(billId);
            trackedBills.sort();
            input.value = '';
            renderBillsList();
            showAlert('Bill added. Click "Save Changes" to update.', 'info');
        }
        
        // Remove bill
        function removeBill(billId) {
            trackedBills = trackedBills.filter(b => b !== billId);
            renderBillsList();
            showAlert('Bill removed. Click "Save Changes" to update.', 'info');
        }
        
        // Save configuration to GitHub
        async function saveConfiguration() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                showAlert('Please enter your GitHub Personal Access Token', 'error');
                return;
            }
            
            if (trackedBills.length === 0) {
                showAlert('Please add at least one bill before saving', 'error');
                return;
            }
            
            showAlert('Saving...', 'info');
            
            try {
                // Prepare new content
                const newConfig = {
                    bills: trackedBills,
                    settings: {
                        notification_email: null,
                        sync_frequency: "daily",
                        timezone: "America/New_York"
                    }
                };
                
                const content = btoa(JSON.stringify(newConfig, null, 2));
                
                // Try to get current file to check if it exists
                const getResponse = await fetch(`https://api.github.com/repos/${REPO_NAME}/contents/${CONFIG_FILE_PATH}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = null;
                let method = 'PUT';
                let commitMessage = '';
                
                if (getResponse.ok) {
                    // File exists - update it
                    const currentFile = await getResponse.json();
                    sha = currentFile.sha;
                    commitMessage = `Update tracked bills via web interface - ${new Date().toISOString()}`;
                } else if (getResponse.status === 404) {
                    // File doesn't exist - create it
                    commitMessage = `Create bills_to_track.json via web interface - ${new Date().toISOString()}`;
                } else {
                    // Some other error
                    const errorData = await getResponse.json();
                    throw new Error(errorData.message || 'Failed to check configuration file. Verify your token has repo access.');
                }
                
                // Create or update file
                const saveBody = {
                    message: commitMessage,
                    content: content
                };
                
                // Only include sha if file exists (for update)
                if (sha) {
                    saveBody.sha = sha;
                }
                
                const saveResponse = await fetch(`https://api.github.com/repos/${REPO_NAME}/contents/${CONFIG_FILE_PATH}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(saveBody)
                });
                
                if (!saveResponse.ok) {
                    const error = await saveResponse.json();
                    
                    // Provide helpful error messages
                    let errorMessage = error.message || 'Failed to save configuration';
                    
                    if (error.message && error.message.includes('Bad credentials')) {
                        errorMessage = 'Invalid token. Please check your GitHub Personal Access Token.';
                    } else if (error.message && error.message.includes('Not Found')) {
                        errorMessage = 'Repository not found. Check that the repository name is correct.';
                    } else if (error.message && error.message.includes('Resource not accessible')) {
                        errorMessage = 'Token does not have access. Make sure your token has "repo" scope.';
                    }
                    
                    throw new Error(errorMessage);
                }
                
                showAlert('‚úÖ Configuration saved! Changes will take effect on next sync.', 'success');
                
                // Save token to localStorage for future use
                saveTokenToStorage();

            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
                console.error('Save error:', error);
            }
        }
        
        // Show alert
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alertClass = type === 'error' ? 'alert-error' : 
                              type === 'success' ? 'alert-success' : 'alert-info';
            
            container.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    container.innerHTML = '';
                    closeConfigModal();
                    location.reload();
                }, 3000);
            }
        }
        
        // Token storage key
        const TOKEN_STORAGE_KEY = 'va_bill_tracker_github_token';

        // Modal controls
        function openConfigModal() {
            document.getElementById('configModal').classList.add('active');
            renderBillsList();
            // Load saved token from localStorage
            const savedToken = localStorage.getItem(TOKEN_STORAGE_KEY);
            if (savedToken) {
                document.getElementById('githubToken').value = savedToken;
            }
        }

        function closeConfigModal() {
            document.getElementById('configModal').classList.remove('active');
            document.getElementById('alertContainer').innerHTML = '';
        }

        // Save token to localStorage when user types
        function saveTokenToStorage() {
            const token = document.getElementById('githubToken').value.trim();
            if (token) {
                localStorage.setItem(TOKEN_STORAGE_KEY, token);
            }
        }
        
        // Close modal on outside click
        document.getElementById('configModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeConfigModal();
            }
        });
        
        // Initialize
        renderBillsList();
    </script>
    </div>
</body>
</html>
