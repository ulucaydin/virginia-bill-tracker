<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virginia Bill Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        .sync-info {
            color: #666;
            font-size: 14px;
        }
        .sync-time {
            color: #667eea;
            font-weight: 600;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn:hover {
            background: #5568d3;
        }
        .btn-secondary {
            background: #6b7280;
        }
        .btn-secondary:hover {
            background: #4b5563;
        }
        .changes-banner {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .changes-banner.no-changes {
            background: #d1fae5;
            border-left-color: #10b981;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            color: #333;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-help {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .bills-list {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            background: #f9fafb;
        }
        .bill-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 3px;
            font-size: 12px;
        }
        .bill-tag button {
            background: none;
            border: none;
            color: white;
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .add-bill-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .add-bill-form input {
            flex: 1;
        }
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        
        .bills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .bill-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .bill-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .bill-card.has-changes {
            border: 2px solid #f59e0b;
            background: #fffbeb;
        }
        .bill-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        .bill-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .status-in-committee {
            background: #dbeafe;
            color: #1e40af;
        }
        .status-passed {
            background: #d1fae5;
            color: #065f46;
        }
        .status-failed {
            background: #fee2e2;
            color: #991b1b;
        }
        .bill-summary {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: calc(5 * 1.6 * 14px);
        }
        .bill-card {
            cursor: pointer;
        }
        .bill-card:hover .bill-summary {
            color: #333;
        }
        .expand-hint {
            color: #667eea;
            font-size: 12px;
            font-weight: 500;
            margin-top: 8px;
        }
        .bill-link {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }
        .bill-link:hover {
            text-decoration: underline;
        }
        .change-badge {
            background: #fef3c7;
            color: #92400e;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        .changes-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .changes-section h2 {
            color: #333;
            margin-bottom: 15px;
        }
        .change-item {
            padding: 12px;
            border-left: 3px solid #f59e0b;
            background: #fffbeb;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .change-timestamp {
            color: #666;
            font-size: 12px;
        }
        .no-bills {
            background: white;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            color: #666;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è Virginia Bill Tracker</h1>
            <div class="header-actions">
                <div class="sync-info">
                    Last synced: <span class="sync-time">January 13, 2026 at 09:53 PM ET</span>
                </div>
                <button class="btn" onclick="openConfigModal()">‚öôÔ∏è Configure Bills</button>
            </div>
        </div>
        
        <div class="changes-banner ">
            <strong>‚ö†Ô∏è 3 change(s) detected since last sync</strong>
        </div>
        <div class="bills-grid">

            <div class="bill-card " onclick="openBillDetail('HB9')">
                <div class="bill-number">
                    HB9
                    
                </div>
                <div class="bill-status status-left-in-committee">
                    Left in Committee
                </div>
                <div class="bill-summary">
                    Animal control officers; additional training. Increases the number of hours of required additional training in animal control and protection from 15 to 24 every three years for all animal control officers and deputy animal control officers employed by a locality.
                </div>
                <div class="expand-hint">Click to view details</div>
                <a href="https://lis.virginia.gov/bill-details/20251/HB9" target="_blank" class="bill-link" onclick="event.stopPropagation()">
                    View on LIS ‚Üí
                </a>
            </div>

            <div class="bill-card " onclick="openBillDetail('SB10')">
                <div class="bill-number">
                    SB10
                    
                </div>
                <div class="bill-status status-left-in-committee">
                    Left in Committee
                </div>
                <div class="bill-summary">
                    Income tax subtraction; military  retirement
benefits; uniformed services. Expands the definition of 'military
benefits' to  include an income tax subtraction of retirement income
received for  service in the uniformed services of the United  States,
which includes the United States Armed  Forces, the commissioned corps
of the National  Oceanic and Atmospheric Administration, and the 
commissioned corps of the United States  Public Health Service. Under
current law, the subtraction is only allowed for  military retirement
income received for service in the  United States Armed Forces.
                </div>
                <div class="expand-hint">Click to view details</div>
                <a href="https://lis.virginia.gov/bill-details/20251/SB10" target="_blank" class="bill-link" onclick="event.stopPropagation()">
                    View on LIS ‚Üí
                </a>
            </div>

            <div class="bill-card " onclick="openBillDetail('SB33')">
                <div class="bill-number">
                    SB33
                    
                </div>
                <div class="bill-status status-passed-senate">
                    Passed Senate
                </div>
                <div class="bill-summary">
                    Supervision of certified registered nurse anesthetists;
 work group; report. Clarifies that supervision  of a certified
registered nurse anesthetist requires that a  licensed doctor of medicine,
osteopathy, podiatry,  or dentistry is present during an operation
or procedure or is immediately available to respond  and provide patient
care as needed. The bill directs the Secretary of Health  and Human
Resources, in collaboration with the Board of Medicine, Board of 
Nursing, and Department of Health Professions, to convene a work group
 of relevant stakeholders to evaluate and make recommendations to
increase the  anesthesia provider workforce in the Commonwealth. The
bill requires the work  group to report its recommendations to the
Chairmen of the Senate Committee on Education and Health and the House
Committee on Health and Human Services by November  1, 2024.
                </div>
                <div class="expand-hint">Click to view details</div>
                <a href="https://lis.virginia.gov/bill-details/20251/SB33" target="_blank" class="bill-link" onclick="event.stopPropagation()">
                    View on LIS ‚Üí
                </a>
            </div>
        </div>

        <div class="changes-section">
            <h2>Recent Changes</h2>

            <div class="change-item">
                <div>Started tracking HB9</div>
                <div class="change-timestamp">
                    January 13, 2026 at 09:53 PM
                </div>
            </div>

            <div class="change-item">
                <div>Started tracking SB10</div>
                <div class="change-timestamp">
                    January 13, 2026 at 09:53 PM
                </div>
            </div>

            <div class="change-item">
                <div>Started tracking SB33</div>
                <div class="change-timestamp">
                    January 13, 2026 at 09:53 PM
                </div>
            </div>

        </div>

    <!-- Bill Detail Modal -->
    <div id="billDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detailBillNumber">Bill Details</h2>
                <button class="close-btn" onclick="closeBillDetail()">&times;</button>
            </div>

            <div class="detail-status-row">
                <span class="bill-status" id="detailBillStatus"></span>
                <span class="detail-patron" id="detailPatron"></span>
            </div>

            <div class="detail-section">
                <h3>Summary</h3>
                <p id="detailSummary" class="detail-summary-full"></p>
            </div>

            <div class="detail-section" id="detailActionSection">
                <h3>Last Action</h3>
                <p id="detailLastAction"></p>
                <p class="detail-date" id="detailLastActionDate"></p>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeBillDetail()">Close</button>
                <a id="detailLisLink" href="#" target="_blank" class="btn">View on LIS ‚Üí</a>
            </div>
        </div>
    </div>

    <style>
        .detail-status-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .detail-patron {
            color: #666;
            font-size: 14px;
        }
        .detail-section {
            margin-bottom: 20px;
        }
        .detail-section h3 {
            color: #333;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .detail-summary-full {
            color: #333;
            font-size: 15px;
            line-height: 1.7;
            white-space: pre-wrap;
        }
        .detail-date {
            color: #666;
            font-size: 13px;
            margin-top: 5px;
        }
    </style>

    <!-- Configuration Modal -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configure Tracked Bills</h2>
                <button class="close-btn" onclick="closeConfigModal()">&times;</button>
            </div>
            
            <div id="alertContainer"></div>
            
            <div class="form-group">
                <label>GitHub Personal Access Token</label>
                <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                <div class="form-help">
                    Required to save changes. Create one at: 
                    <a href="https://github.com/settings/tokens/new?scopes=repo&description=Virginia%20Bill%20Tracker" target="_blank">
                        GitHub Settings ‚Üí Tokens
                    </a>
                    <br>Select "repo" scope when creating the token.
                </div>
            </div>
            
            <div class="form-group">
                <label>Tracked Bills</label>
                <div class="bills-list" id="billsList">
                    <!-- Bills will be rendered here -->
                </div>
                <div class="add-bill-form">
                    <input type="text" id="newBillInput" placeholder="Enter bill ID (e.g., HB1, SB200)" 
                           onkeypress="if(event.key==='Enter')addBill()">
                    <button class="btn" onclick="addBill()">Add Bill</button>
                </div>
                <div class="form-help">
                    Find bill IDs at: <a href="https://lis.virginia.gov/bill-search" target="_blank">Virginia LIS</a>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeConfigModal()">Cancel</button>
                <button class="btn" onclick="saveConfiguration()">üíæ Save Changes</button>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration data
        let trackedBills = ["HB9", "SB10", "SB33"];
        const REPO_NAME = 'YOUR-USERNAME/virginia-bill-tracker';
        const CONFIG_FILE_PATH = 'bills_to_track.json';

        // Bills data for detail modal
        const billsData = {"HB9": {"bill_number": "HB9", "status": "Left in Committee", "summary": "Animal control officers; additional training. Increases the number of hours of required additional training in animal control and protection from 15 to 24 every three years for all animal control officers and deputy animal control officers employed by a locality.", "last_action": "Left in Agriculture, Chesapeake and Natural Resources", "last_action_date": "11/18/2024", "patron": "Ennis", "bill_url": "https://lis.virginia.gov/bill-details/20251/HB9"}, "SB10": {"bill_number": "SB10", "status": "Left in Committee", "summary": "Income tax subtraction; military  retirement\r\nbenefits; uniformed services. Expands the definition of 'military\r\nbenefits' to  include an income tax subtraction of retirement income\r\nreceived for  service in the uniformed services of the United  States,\r\nwhich includes the United States Armed  Forces, the commissioned corps\r\nof the National  Oceanic and Atmospheric Administration, and the \r\ncommissioned corps of the United States  Public Health Service. Under\r\ncurrent law, the subtraction is only allowed for  military retirement\r\nincome received for service in the  United States Armed Forces.", "last_action": "Left in Finance and Appropriations", "last_action_date": "11/19/2024", "patron": "Reeves", "bill_url": "https://lis.virginia.gov/bill-details/20251/SB10"}, "SB33": {"bill_number": "SB33", "status": "Passed Senate", "summary": "Supervision of certified registered nurse anesthetists;\r\n work group; report. Clarifies that supervision  of a certified\r\nregistered nurse anesthetist requires that a  licensed doctor of medicine,\r\nosteopathy, podiatry,  or dentistry is present during an operation\r\nor procedure or is immediately available to respond  and provide patient\r\ncare as needed. The bill directs the Secretary of Health  and Human\r\nResources, in collaboration with the Board of Medicine, Board of \r\nNursing, and Department of Health Professions, to convene a work group\r\n of relevant stakeholders to evaluate and make recommendations to\r\nincrease the  anesthesia provider workforce in the Commonwealth. The\r\nbill requires the work  group to report its recommendations to the\r\nChairmen of the Senate Committee on Education and Health and the House\r\nCommittee on Health and Human Services by November  1, 2024.", "last_action": "Left in Health and Human Services", "last_action_date": "11/18/2024", "patron": "Locke", "bill_url": "https://lis.virginia.gov/bill-details/20251/SB33"}};

        // Bill Detail Modal functions
        function openBillDetail(billNum) {
            const bill = billsData[billNum];
            if (!bill) return;

            document.getElementById('detailBillNumber').textContent = bill.bill_number;
            document.getElementById('detailBillStatus').textContent = bill.status;
            document.getElementById('detailBillStatus').className = 'bill-status status-' + bill.status.toLowerCase().replace(/ /g, '-');
            document.getElementById('detailSummary').textContent = bill.summary;
            document.getElementById('detailLisLink').href = bill.bill_url;

            // Show patron if available
            const patronEl = document.getElementById('detailPatron');
            if (bill.patron) {
                patronEl.textContent = 'Patron: ' + bill.patron;
                patronEl.style.display = 'inline';
            } else {
                patronEl.style.display = 'none';
            }

            // Show last action if available
            const actionSection = document.getElementById('detailActionSection');
            if (bill.last_action && bill.last_action !== 'No action recorded') {
                document.getElementById('detailLastAction').textContent = bill.last_action;
                document.getElementById('detailLastActionDate').textContent = bill.last_action_date || '';
                actionSection.style.display = 'block';
            } else {
                actionSection.style.display = 'none';
            }

            document.getElementById('billDetailModal').classList.add('active');
        }

        function closeBillDetail() {
            document.getElementById('billDetailModal').classList.remove('active');
        }

        // Close detail modal on outside click
        document.getElementById('billDetailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBillDetail();
            }
        });

        // Render bills list
        function renderBillsList() {
            const container = document.getElementById('billsList');
            if (trackedBills.length === 0) {
                container.innerHTML = '<p style="color: #666; padding: 10px;">No bills tracked yet. Add one below.</p>';
                return;
            }
            
            container.innerHTML = trackedBills.map(bill => 
                `<span class="bill-tag">
                    ${bill}
                    <button onclick="removeBill('${bill}')">&times;</button>
                </span>`
            ).join('');
        }
        
        // Add bill
        function addBill() {
            const input = document.getElementById('newBillInput');
            let billId = input.value.trim().toUpperCase();
            
            if (!billId) return;
            
            // Validate format (HB/SB followed by number)
            if (!billId.match(/^(HB|SB|HJR|SJR|HR|SR)\d+$/i)) {
                showAlert('Please enter a valid bill ID (e.g., HB1, SB200)', 'error');
                return;
            }
            
            if (trackedBills.includes(billId)) {
                showAlert('Bill already tracked', 'error');
                return;
            }
            
            trackedBills.push(billId);
            trackedBills.sort();
            input.value = '';
            renderBillsList();
            showAlert('Bill added. Click "Save Changes" to update.', 'info');
        }
        
        // Remove bill
        function removeBill(billId) {
            trackedBills = trackedBills.filter(b => b !== billId);
            renderBillsList();
            showAlert('Bill removed. Click "Save Changes" to update.', 'info');
        }
        
        // Save configuration to GitHub
        async function saveConfiguration() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                showAlert('Please enter your GitHub Personal Access Token', 'error');
                return;
            }
            
            if (trackedBills.length === 0) {
                showAlert('Please add at least one bill before saving', 'error');
                return;
            }
            
            showAlert('Saving...', 'info');
            
            try {
                // Prepare new content
                const newConfig = {
                    bills: trackedBills,
                    settings: {
                        notification_email: null,
                        sync_frequency: "daily",
                        timezone: "America/New_York"
                    }
                };
                
                const content = btoa(JSON.stringify(newConfig, null, 2));
                
                // Try to get current file to check if it exists
                const getResponse = await fetch(`https://api.github.com/repos/${REPO_NAME}/contents/${CONFIG_FILE_PATH}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = null;
                let method = 'PUT';
                let commitMessage = '';
                
                if (getResponse.ok) {
                    // File exists - update it
                    const currentFile = await getResponse.json();
                    sha = currentFile.sha;
                    commitMessage = `Update tracked bills via web interface - ${new Date().toISOString()}`;
                } else if (getResponse.status === 404) {
                    // File doesn't exist - create it
                    commitMessage = `Create bills_to_track.json via web interface - ${new Date().toISOString()}`;
                } else {
                    // Some other error
                    const errorData = await getResponse.json();
                    throw new Error(errorData.message || 'Failed to check configuration file. Verify your token has repo access.');
                }
                
                // Create or update file
                const saveBody = {
                    message: commitMessage,
                    content: content
                };
                
                // Only include sha if file exists (for update)
                if (sha) {
                    saveBody.sha = sha;
                }
                
                const saveResponse = await fetch(`https://api.github.com/repos/${REPO_NAME}/contents/${CONFIG_FILE_PATH}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(saveBody)
                });
                
                if (!saveResponse.ok) {
                    const error = await saveResponse.json();
                    
                    // Provide helpful error messages
                    let errorMessage = error.message || 'Failed to save configuration';
                    
                    if (error.message && error.message.includes('Bad credentials')) {
                        errorMessage = 'Invalid token. Please check your GitHub Personal Access Token.';
                    } else if (error.message && error.message.includes('Not Found')) {
                        errorMessage = 'Repository not found. Check that the repository name is correct.';
                    } else if (error.message && error.message.includes('Resource not accessible')) {
                        errorMessage = 'Token does not have access. Make sure your token has "repo" scope.';
                    }
                    
                    throw new Error(errorMessage);
                }
                
                showAlert('‚úÖ Configuration saved! Changes will take effect on next sync.', 'success');
                
                // Clear token for security
                setTimeout(() => {
                    document.getElementById('githubToken').value = '';
                }, 2000);
                
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
                console.error('Save error:', error);
            }
        }
        
        // Show alert
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alertClass = type === 'error' ? 'alert-error' : 
                              type === 'success' ? 'alert-success' : 'alert-info';
            
            container.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    container.innerHTML = '';
                    closeConfigModal();
                    location.reload();
                }, 3000);
            }
        }
        
        // Modal controls
        function openConfigModal() {
            document.getElementById('configModal').classList.add('active');
            renderBillsList();
        }
        
        function closeConfigModal() {
            document.getElementById('configModal').classList.remove('active');
            document.getElementById('alertContainer').innerHTML = '';
        }
        
        // Close modal on outside click
        document.getElementById('configModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeConfigModal();
            }
        });
        
        // Initialize
        renderBillsList();
    </script>
    </div>
</body>
</html>
